<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    let user1 = {
      name: 'John'
    }
    function wrap(target) {
      return new Proxy(target, {
        /* 你的代码 */
        get(target, key, receiver) {
          if (key in target) {
            return Reflect.get(...arguments)
          } else {
            throw new ReferenceError(`property doesn't exist: "${key}"`)
          }
        }
      })
    }
    user1 = wrap(user1)

    // console.log(user1.name) // John
    // console.log(user1.age) // ReferenceError: Property doesn't exist

    let handlers = Symbol('handlers')

    function makeObservable(target) {
      target[handlers] = []
      target.observe = function (fn) {
        this[handlers].push(fn)
      }

      return new Proxy(target, {
        set(target, key, value, receiver) {
          const success = Reflect.set(...arguments)
          if (success) {
            target[handlers].forEach(fn => fn(key, value))
          }
          return success
        }
      })
    }
    let user = { a: 1, b: 2 }
    user = makeObservable(user)
    user.observe((key, value) => {
      console.log(`SET ${key}=${value}`)
    })
    // console.log('user', user)
    user.name = 'John' // alerts：设置 name 属性为 John
    user.a = 'Johnxx' // alerts：设置 name 属性为 John

    function enhancedArray(arr) {
      return new Proxy(arr, {
        get(target, property, receiver) {
          const range = getRange(property)
          const indices = range ? range : getIndices(property)
          const values = indices.map(function (index) {
            const key = index < 0 ? String(target.length + index) : index
            return Reflect.get(target, key, receiver)
          })
          return values.length === 1 ? values[0] : values
        }
      })

      function getRange(str) {
        var [start, end] = str.split(':').map(Number)
        if (typeof end === 'undefined') return false

        let range = []
        for (let i = start; i < end; i++) {
          range = range.concat(i)
        }
        return range
      }

      function getIndices(str) {
        return str.split(',').map(Number)
      }
    }
    const enhancedObject = target =>
      new Proxy(target, {
        get(target, property) {
          if (property in target) {
            return target[property]
          } else {
            return searchFor(property, target)
          }
        }
      })

    function searchFor(property, target) {
      let value = null
      for (const key of Object.keys(target)) {
        if (typeof target[key] === 'object') {
          searchFor(property, target[key])
        } else if (typeof target[property] !== 'undefined') {
          value = target[property]
          break
        }
      }
      return value
    }
  </script>
</html>
